#!/usr/bin/env bash

cd "$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )" || exit 1

clean_nix() {
    echo "Removing clowder.egg-info"
    sudo -H rm -rf ../clowder_repo.egg-info
    echo "Removing dist"
    sudo -H rm -rf ../dist
    echo "Removing build"
    sudo -H rm -rf ../build
    echo "pip uninstall clowder"
    sudo -H pip2 uninstall clowder-repo
    sudo -H pip3 uninstall clowder-repo
    echo "Remove installed clowder binary"
    PYTHON3_PATH="$(which python3)"
    CLOWDER_PATH="$(dirname $PYTHON3_PATH)/clowder"
    sudo -H rm "$CLOWDER_PATH"
}

clean_examples() {
    echo "Removing existing example files"
    if [ -n "$TRAVIS_OS_NAME" ]; then
        ../examples/cats/clean.sh
        ../examples/llvm-projects/clean.sh
        ../examples/swift-projects/clean.sh
    else
        rm -rf "$HOME/.clowder_tests"
    fi
}

case "$(uname)" in
    Linux*) export MY_PLATFORM="linux";
        clean_nix
        clean_examples
        ;;
    Darwin*) export MY_PLATFORM="osx";
        clean_nix
        clean_examples
        ;;
    CYGWIN*) export MY_PLATFORM="windows";
        pip3 uninstall clowder-repo
        clean_examples
        ;;
esac

echo $MY_PLATFORM
